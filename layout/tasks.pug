section.tasks
    .tasks__text
        div.text-item
            h4 задача
            h3 Как сократить затраты на транспорт и склады без потерь в клиентском сервисе?
        div.text-item
            h4 Решение
            p Оптимальное размещение складов и распределение запасов по ним снижают издержки благодаря лучшей загрузке транспорта и сокращению плеч доставки.
    .tasks__decorate_center
    div.tasks__block
        h4.tasks__label
            span.label-txt Какие задачи решает моделирование?
            span.label-cnt
                |/&#32;
                span.tasks-cnt 01
                |&#32; — 04 /
        div.tasks__cards
            div.tasks-item
                include vectors/pic7
                h3 Оценка соответствия логистической сети целям компании
                p Где теряются деньги и в каких точках сеть работает неэффективно по сравнению с оптимальной.
            div.tasks-item
                include vectors/pic8
                h3 Быстрая адаптация к росту и изменениям стратегии
                p Как перестроить логистику под рост бизнеса, региональную экспансию, изменение объемов или выход в новые каналы продаж (маркетплейсы и др.)
            div.tasks-item
                include vectors/pic9
                h3 Оценка эффекта от оптимизации сети
                p Достоверный расчет экономии при переходе от текущих схем поставок к распределенной складской сети.
            div.tasks-item
                include vectors/pic10
                h3 Сравнение затрат на логистику с рынком
                p Бенчмарк транспортных и складских затрат с отраслью и рыночными тарифами на склады и транспорт.
    .tasks__decorate_bottom
script.
    //document.addEventListener("DOMContentLoaded", () => {
    //    gsap.registerPlugin(ScrollTrigger, ScrollSmoother, TextPlugin)

        const sections = gsap.utils.toArray(".tasks-item");
        const container = document.querySelector(".tasks");
        //const totalHeight = container.querySelector(".tasks__block").getBoundingClientRect().height * sections.length;
        //container.style.height = `${totalHeight}px`;


        const count = document.querySelector(".tasks-cnt");
        const wrap = gsap.utils.wrap(0, sections.length);
        let animating;
        let currentIndex = 0;

        //function goToNextCard() {
        //    if (currentIndex >= sections.length - 1) return;
        //
        //    const currentCard = sections[currentIndex];
        //    const nextCard = sections[currentIndex + 1];
        //
        //    // Анимация исчезновения текущей карточки
        //    gsap.to(currentCard, {
        //        transform: "translate(0, 100%)",
        //        opacity: 0,
        //        duration: 0.8,
        //        ease: "power2.inOut",
        //    });
        //
        //    // Анимация появления следующей карточки
        //    gsap.fromTo(nextCard,
        //        {
        //            transform: "translate(0, -.8rem) scale(94%)",
        //            opacity: .3,
        //            backgroundColor: "#6F92E8"
        //        },
        //        {
        //            opacity: 1,
        //            backgroundColor: "#fffc",
        //            transform: "translate(0, 0) scale(100%)",
        //            duration: 0.8,
        //            ease: "power2.inOut",
        //            onStart: () => {
        //                nextCard.classList.add('active');
        //            }
        //        }
        //    );
        //
        //    currentIndex++;
        //}

        // Функция для возврата к предыдущей карточке
        //function goToPrevCard() {
        //    if (currentIndex <= 0) return;
        //
        //    const currentCard = cards[currentIndex];
        //    const prevCard = cards[currentIndex - 1];
        //
        //    // Анимация исчезновения текущей карточки
        //    gsap.to(currentCard, {
        //        transform: "translate(0, -.8rem) scale(94%)",
        //        opacity: .3,
        //        backgroundColor: "#6F92E8",
        //        duration: 0.8,
        //        ease: "power2.inOut"
        //    });
        //
        //    // Анимация появления предыдущей карточки
        //    gsap.fromTo(prevCard,
        //        {
        //            transform: "translate(0, 100%)",
        //            opacity: 0, },
        //        {
        //            opacity: 1,
        //            backgroundColor: "#fffc",
        //            transform: "translate(0, 0) scale(100%)",
        //            duration: 0.8,
        //            ease: "power2.inOut"
        //        }
        //    );
        //
        //    currentIndex--;
        //}

        // Создаем триггеры для каждой карточки
        //sections.forEach((card, index) => {
        //    if (index === 0) return; // Пропускаем первую карточку
        //
        //    const trigger = gsap.timeline({
        //        scrollTrigger: {
        //            trigger: container,
        //            start: `top center`,
        //            end: `bottom center`,
        //            scrub: 1,
        //            onEnter: () => {
        //                if (index > currentIndex) {
        //                    goToNextCard();
        //                }
        //            },
        //            onEnterBack: () => {
        //                if (index <= currentIndex) {
        //                    goToPrevCard();
        //                }
        //            }
        //        }
        //    });
        //});
        //
        //// Обновление при изменении размера окна
        //window.addEventListener('resize', function() {
        //    const newTotalHeight = cards.length * (window.innerHeight * 0.5);
        //    cardsSection.style.height = `${newTotalHeight}px`;
        //    ScrollTrigger.refresh();
        //});

        function gotoSection(index) {
            animating = true;
            index = wrap(index);

            gsap.timeline({
                defaults: { duration: 1, ease: "expo.inOut" },
                onComplete: () => {
                    animating = false;
                }
            }).to(sections[currentIndex], {
                transform: "translate(0, 100%)",
                opacity: 0
            })

            gsap.timeline({
                defaults: { duration: 1, ease: "expo.inOut" },
                onComplete: () => {
                    animating = false;
                    if (index === 3) {
                        setTimeout(() => {
                        document.querySelector(".scenarios").scrollIntoView({behavior: 'smooth'});
                        }, 1500)
                        //gsap.to(window, {
                        //    duration: 1.5, // 1.5 seconds
                        //    ease: "power2.inOut",
                        //    scrollTo: document.querySelector(".scenarios")
                        //});
                    } else {
                        currentIndex = index
                    }
                }
            }).set(count, { text: `0${index + 1}` }, 1)
            gsap.timeline({
                defaults: { duration: 1, ease: "expo.inOut" },
                onComplete: () => {
                    animating = false;
                }
            }).to(sections[index], {
                    transform: "translate(0, 0) scale(100%)",
                    opacity: 1,
                    backgroundColor: "#FFFFFFCC"
                }, 0.5)
            if (sections[index + 1]) {
                gsap.timeline({
                    defaults: { duration: 1, ease: "expo.inOut" },
                    onComplete: () => {
                        animating = false;
                    }
                }).to(sections[index + 1], {
                   transform: "translate(0, -.8rem) scale(94%)",
                   opacity: .3,
               })
            }
            if (sections[index + 2]) {
                gsap.timeline({
                    defaults: { duration: 1, ease: "expo.inOut" },
                    onComplete: () => {
                        animating = false;
                    }
                }).to(sections[index + 2], {
                    transform: "translate(0, -1.6rem) scale(88%)",
                    opacity: .3,
                })
            }
        }

        const tasksObserver = Observer.create({
            type: "wheel,touch,pointer",
            preventDefault: true,
            wheelSpeed: -1,
            target: ".tasks",
            y: -100,
            pin: true,
            onUp: () => {
                console.log("down");
                if (animating) return;
                gotoSection(currentIndex + 1);
                console.log(currentIndex)
                //if (currentIndex === 3) {
                //    setTimeout(() => {
                //        tasksObserver.disable()
                //    }, 1000)
                //}

            },
            onDown: () => {
                console.log("up");
                if (animating) return;
                gotoSection(currentIndex - 1);
            },
            tolerance: 10
        });

    //})
    //ScrollTrigger.create({
    //    trigger: container,
    //    animation: animation,
    //    start: "top 50%", // Отслеживаем когда верх элемента достигнет центра экрана
    //    end: "bottom 50%", // Отслеживаем когда низ элемента покинет центр экрана
    //    scrub: 1, // Синхронизируем анимацию с прокруткой
    //});
